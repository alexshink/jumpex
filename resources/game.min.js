function addClass(id,addedClass){document.getElementById(id).classList.add(addedClass)};function removeClass(id,removeClass){document.getElementById(id).classList.remove(removeClass)};var page=document.getElementById('page'),road=document.getElementById('road'),obstacles=document.getElementById('obstacles'),renderLoopTimeout,roadSpeed=parseFloat(getComputedStyle(road).animationDuration),pixelsPerMs=roadSpeed/388,obstaclesItems={bomb:{img:'resources/img/bomb.png',cls:'obstacle_bomb'},fire:{img:'resources/img/fire.gif',cls:'obstacle_fire'},plasm:{img:'resources/img/plasm.gif',cls:'obstacle_plasm'},},btnJump=document.getElementById('btnJump');document.getElementById('start').onclick=function(){if(page.className.indexOf('rungame')==-1){runGame()}};function runGame(){addClass('page','page_rungame');obstacles.innerHTML='';clearTimeout(renderLoopTimeout);var heroRender=document.createElement('div'),hero;heroRender.id='hero';heroRender.className='hero';heroRender.innerHTML='<img src="resources/img/jumpex.gif">';page.appendChild(heroRender);hero=document.getElementById('hero');function heroJump(){if(hero.className.indexOf('hero_jump')==-1){addClass('hero','hero_jump');setTimeout(function(){try{removeClass('hero','hero_jump')}catch{}},700)}};document.onkeydown=function(e){if(e.keyCode==38){heroJump()}};btnJump.onclick=function(){heroJump()};var renderCoins=document.createElement('div'),coinsCurrent,coinsAll;renderCoins.id='coins';renderCoins.className='coins';renderCoins.innerHTML='<div class="coins__inner">'+'<p id="coins__current" class="coins__current">0</p>'+'<p class="coins__bank">'+'Bank: <span id="coins__all" class="coins__all">'+localStorage.coins+'</span>'+'</p>'+'</div>';page.appendChild(renderCoins);coinsCurrent=document.getElementById('coins__current');coinsAll=document.getElementById('coins__all');function increaseCoins(count){if(!count){count=1};coinsCurrent.innerHTML=parseInt(coinsCurrent.innerHTML)+count;localStorage.coins=parseInt(localStorage.coins)+count;coinsAll.innerHTML=localStorage.coins};if(!localStorage.coins){localStorage.coins=0};var getCoins;setTimeout(function(){getCoins=setInterval(function(){increaseCoins()},100)},1400);function renderObstacle(){var renderObstacle=document.createElement('div'),renderObstacleImg=document.createElement('img'),lastObstacle,lastObstacleSpeed,randomObstacle=obstaclesItems[Object.keys(obstaclesItems)[Object.keys(obstaclesItems).length*Math.random()<<0]];renderObstacleImg.src=randomObstacle.img;renderObstacle.className='obstacle '+randomObstacle.cls;renderObstacle.appendChild(renderObstacleImg);obstacles.appendChild(renderObstacle);lastObstacle=obstacles.lastChild;lastObstacleSpeed=(lastObstacle.getBoundingClientRect().left+lastObstacle.getBoundingClientRect().width)*pixelsPerMs;lastObstacle.style['animation-duration']=lastObstacleSpeed+'s'};(function renderObstacleLoop(){var obstacleRenderDelay=Math.floor(Math.random()*1500)+700;if(page.className.indexOf('page_rungame')!=-1){renderLoopTimeout=setTimeout(function(){renderObstacle();renderObstacleLoop()},obstacleRenderDelay)}}());document.addEventListener('animationend',function(e){if(e.target.className.indexOf('obstacle')!=-1){e.target.remove()}},!1);var obstacleDetection=setInterval(function(){try{var heroPosX=hero.getBoundingClientRect().left+hero.getBoundingClientRect().width,heroPosY=parseFloat(getComputedStyle(hero).bottom),firstObstacle=document.getElementsByClassName('obstacle')[0],obstaclePosX=firstObstacle.getBoundingClientRect().left,obstaclePosY=parseFloat(getComputedStyle(firstObstacle).bottom)+firstObstacle.getBoundingClientRect().height;if(obstaclePosX<=heroPosX&&obstaclePosY>heroPosY){stopGame();if(firstObstacle.className.indexOf('obstacle_bomb')!=-1){firstObstacle.firstElementChild.remove();firstObstacle.appendChild(document.createElement('img'));firstObstacle.firstElementChild.src='resources/img/explosive.gif';setTimeout(function(){firstObstacle.remove()},2500)};firstObstacle.classList.add('obstacle_active')}}catch{}},10);function stopGame(){clearInterval(getCoins);renderCoins.remove();clearInterval(obstacleDetection);removeClass('page','page_rungame');hero.remove()}}
