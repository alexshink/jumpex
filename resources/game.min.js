function getId(a){return document.getElementById(a)}function addClass(a,b){getId(a).classList.add(b)}function removeClass(a,b){getId(a).classList.remove(b)}var renderLoopTimeout,html=document.documentElement,page=getId("page"),road=getId("road"),obstacles=getId("obstacles"),roadSpeed=parseFloat(getComputedStyle(road).animationDuration),pixelsPerMs=roadSpeed/388,obstaclesItems={bomb:{img:"resources/img/obstacles/bomb.png",cls:"obstacle_bomb obstacle_destructible"},fire:{img:"resources/img/obstacles/fire.gif",cls:"obstacle_fire"},plasm:{img:"resources/img/obstacles/plasm.gif",cls:"obstacle_plasm"},robot:{img:"resources/img/obstacles/robot.gif",cls:"obstacle_robot obstacle_destructible"}},menu=getId("menu"),menuButtons=document.getElementsByClassName("menu__button");function preloadObstacles(a,b){function c(a,b){var c=new Image;c.onload=b,c.src=a}var d=0,e=Object.keys(a).length;Object.keys(a).map(function(f){c(a[f].img,function(){d++,d==e&&b()})})}preloadObstacles(obstaclesItems,function(){});for(var i=0;i<menuButtons.length;i++)menuButtons[i].addEventListener("click",function(){if(-1==page.className.indexOf("page_rungame")&&-1==menu.className.indexOf("menu_disable"))switch(this.id){case"menu-start":runGame();break;case"menu-fullscreen":this.classList.toggle("menu__button_fullscreen"),-1==this.className.indexOf("fullscreen")?closeFullscreen():openFullscreen();;}},!1);function runGame(){function a(){-1==getId("hero").className.indexOf("hero_jump")&&(addClass("hero","hero_jump"),setTimeout(function(){try{removeClass("hero","hero_jump")}catch{}},700))}function b(){if(-1==getId("hero").className.indexOf("hero_fire")){var a=document.createElement("span");a.className="fire-shot",a.style.bottom=parseFloat(getComputedStyle(getId("hero")).bottom)+35+"px",a.style.left=getId("hero").getBoundingClientRect().left+40+"px",page.appendChild(a),shotSpeed=window.innerWidth*(pixelsPerMs-.001);var b=document.querySelectorAll(".fire-shot:nth-last-of-type(1)")[0];b.style.transition="transform linear "+shotSpeed+"s",setTimeout(function(){b.style.transform="translateX("+window.innerWidth+"px)"},10),addClass("hero","hero_fire"),setTimeout(function(){removeClass("hero","hero_fire")},1200)}}function c(a){a||(a=1);f.innerHTML=parseInt(f.innerHTML)+a,localStorage.coins=parseInt(localStorage.coins)+a,g.innerHTML=localStorage.coins}function d(){if(-1!=page.className.indexOf("page_rungame")){var a,b,c=document.createElement("div"),d=document.createElement("img"),e=obstaclesItems[Object.keys(obstaclesItems)[Object.keys(obstaclesItems).length*Math.random()<<0]];d.src=e.img,c.className="obstacle "+e.cls,c.appendChild(d),obstacles.appendChild(c),a=obstacles.lastChild,b=(a.getBoundingClientRect().left+100)*pixelsPerMs,a.style.transition="transform linear "+b+"s",a.style.transform="translateX(-"+(a.getBoundingClientRect().left+100)+"px)"}}addClass("page","page_rungame"),addClass("menu","menu_disable"),obstacles.innerHTML="";var e=document.createElement("div");e.id="hero",e.className="hero",e.innerHTML="<img src=\"resources/img/jumpex.gif\">",page.appendChild(e);document.onkeydown=function(c){switch(c.keyCode){case 38:a();break;case 32:b();}},document.addEventListener("touchstart",function(c){switch(c.target.id){case"control-jump":a();break;case"control-fire":b();}},!1),localStorage.coins||(localStorage.coins=0);var f,g,h=document.createElement("div");h.id="coins",h.className="coins",h.innerHTML="<div class=\"coins__inner\"><p id=\"coins__current\" class=\"coins__current\">0</p><p class=\"coins__bank\">Bank: <span id=\"coins__all\" class=\"coins__all\">"+localStorage.coins+"</span></p></div>",page.appendChild(h),f=getId("coins__current"),g=getId("coins__all");var i;setTimeout(function(){i=setInterval(function(){c()},100)},1400);(function a(){var b=Math.floor(1500*Math.random())+700;-1!=page.className.indexOf("page_rungame")&&(renderLoopTimeout=setTimeout(function(){d(),a()},b))})();var j=setInterval(function(){try{var a=getId("hero").getBoundingClientRect().left,b=a+getId("hero").getBoundingClientRect().width,c=parseFloat(getComputedStyle(getId("hero")).bottom),d=document.getElementsByClassName("obstacle")[0],e=d.getBoundingClientRect().left,f=e+d.getBoundingClientRect().width,g=parseFloat(getComputedStyle(d).bottom)+d.getBoundingClientRect().height;e<=b&&f>a&&g>c&&(d.classList.add("obstacle_active"),window.stopGame(),-1!=d.className.indexOf("destructible")&&(d.firstElementChild.remove(),d.appendChild(document.createElement("img")),d.firstElementChild.src="resources/img/obstacles/explosive.gif",setTimeout(function(){d.remove()},2500)));-100>=d.getBoundingClientRect().left&&d.remove();for(var h,j=document.getElementsByClassName("fire-shot")[0],k=j.getBoundingClientRect().left,l=j.getBoundingClientRect().width,m=parseFloat(getComputedStyle(j).bottom),n=document.getElementsByClassName("obstacle_destructible"),o=0;o<n.length;o++)h=n[o].getBoundingClientRect().left+n[o].getBoundingClientRect().width,h<k&&n.splice(o,1);var p=n[0].getBoundingClientRect().left,q=parseFloat(getComputedStyle(n[0]).bottom)+n[0].getBoundingClientRect().height;k+l>=p&&m-15<=q&&(j.remove(),n[0].remove());k>window.innerWidth&&j.remove()}catch{}},10);window.stopGame=function(){clearInterval(i),clearInterval(j),menu.scrollTop=0,removeClass("page","page_rungame"),setTimeout(function(){removeClass("menu","menu_disable")},700),h.remove(),getId("hero").remove();var a=document.getElementsByClassName("obstacle")[0];a.style.left=a.getBoundingClientRect().left+"px",a.style.transition="none",a.style.transform="none"}}window.addEventListener("resize",function(){-1!=page.className.indexOf("page_rungame")&&window.stopGame()},!1);function openFullscreen(){html.requestFullscreen?html.requestFullscreen():html.mozRequestFullScreen?html.mozRequestFullScreen():html.webkitRequestFullscreen?html.webkitRequestFullscreen():html.msRequestFullscreen&&html.msRequestFullscreen()}function closeFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}
